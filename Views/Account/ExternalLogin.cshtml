@using ICARUS.Models
@using Microsoft.Owin.Security
@model ICARUS.Models.ExternalLoginListViewModel
@{
    ViewBag.Title = "ExternalLogin";
}
@section viewInit {
    @if (User.Identity.IsAuthenticated) {
        <script type="text/javascript">
            console.log(100, 'You are already logged in.\nRedirecting...');
            setTimeout(() => {
                location.href = '/';
            }, 1000);
        </script>
    } else {
        <h4>OAuth2 Login</h4>
        var loginProviders = Context.GetOwinContext().Authentication.GetExternalAuthenticationTypes();
        @*
            See <a href="http://go.microsoft.com/fwlink/?LinkId=403804">this article</a>
            for details on setting up this ASP.NET application to support logging in via external services
        *@
        if (loginProviders.Count() == 0) {
            <div><p>There are no external authentication services configured</p></div>
        } else {
            <h1>Authenticating...</h1>
            <form id="login-external" class="login-external" 
                action="/Account/ExternalLogin/externalLogin?ReturnUrl=%2F" 
                method="post" style="display:none;"
            >
                @Html.AntiForgeryToken()
                <input type="hidden" name="provider" value="@Request["provider"]" />
                @*foreach (AuthenticationDescription p in loginProviders) {
                    <button type="submit" class="btn" id="@p.AuthenticationType"
                            name="provider" value="@p.AuthenticationType"
                            title="Log in using your @p.Caption account">
                        @p.AuthenticationType
                    </button>
                }*@
            </form>
        }
        <script>
            //let url = new URL(window.location.href);
            //let provider = url.searchParams.get('provider');
            //document.getElementById(provider).click(); // clicks ExternalLogin.cshtml form that returns to '/'
            document.getElementById('login-external').submit();
        </script>
        <!--<script src="@Url.Content("~/Scripts/dist/icarus/controller/init.js")" type="module"></script>-->
    }
}