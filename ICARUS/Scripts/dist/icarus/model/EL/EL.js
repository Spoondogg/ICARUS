import MODEL,{ATTRIBUTES}from"../MODEL.js";import{HtmlElement}from"../../enums/HtmlElement.js";import MissingContainerError from"../../error/MissingContainerError.js";import RecursionLimitError from"../../error/RecursionLimitError.js";import{STATUS}from"../../enums/STATUS.js";export default class EL extends MODEL{constructor(t,e="DIV",s,i,r){super(s.attributes),this.setContainer(),this.node=t,this.className=this.constructor.name,this.element=e||HtmlElement.DEFAULT,this.status=STATUS.DEFAULT,this.factory=null,this.children=r||[],this.callbacks={},this.make(t,s,i)}make(t,e,s){try{t===document.body?this.el=t.appendChild(document.createElement(this.element)):this.el=t.el.appendChild(document.createElement(this.element)),this.merge(e),this.setInnerHTML(s)}catch(t){throw t}return this.el}getProtoTypeByClass(t,e=this.node,s=0){if(e===document.body)return null;let i=s+1;try{if(i<100)return Reflect.getPrototypeOf(Reflect.getPrototypeOf(Reflect.getPrototypeOf(e))).constructor.name===t.toString()||Reflect.getPrototypeOf(Reflect.getPrototypeOf(e)).constructor.name===t.toString()||Reflect.getPrototypeOf(e).constructor.name===t.toString()?e:this.getProtoTypeByClass(t,e.node,i);throw new RecursionLimitError(this.className+".getProtoTypeByClass(): Exceeded attempt limit. (Attempt "+s+")")}catch(t){if("TypeError"!==t.name)throw console.log("An unknown error occurred"),t}}setContainer(){this.container=this.getProtoTypeByClass("CONTAINER")}getContainer(){try{return void 0===this.container?(this.container=this.getProtoTypeByClass("CONTAINER"),this.container):this.container}catch(t){throw console.log(t),new MissingContainerError(this.className+" is unable to find a parent Container")}}getMainContainer(){if(void 0!==this.container)try{return this.container.getMainContainer()}catch(t){console.warn("EL{"+this.className+"} Unable to retrieve Container",t)}}edit(){try{let t=this.getMainContainer().stickyFooter;this.addClass("edit"),this.status=STATUS.LOCKED,this.editor=new EL(t,"TEXTAREA",new MODEL(new ATTRIBUTES({value:this.el.innerHTML})),this.el.innerHTML),this.editor.el.onkeyup=function(){this.el.innerHTML=this.editor.el.value}.bind(this),this.editor.el.onblur=function(){try{this.getContainer().data[this.className.toLowerCase()]=this.editor.el.value,this.editor.destroy(),this.removeClass("edit"),this.getContainer().quickSave(!0)&&this.getMainContainer().stickyFooter.hide()}catch(t){throw t}}.bind(this),this.editor.el.focus(),t.show(),event.stopPropagation()}catch(t){console.log(t)}}enableEdit(){try{this.getMainContainer().getDev()&&(this.el.ondblclick=this.edit.bind(this))}catch(t){console.log("EL{"+this.className+"}.getMainContainer() error",this)}}create(t){let e=null;try{this.callbacks[t.className].forEach(s=>{e=s(t)})}catch(e){return console.log(0,this.className+'.create(): No constructor exists for className "'+t.className+'"',e),!1}return e}addCase(t,e){this.callbacks[t]=[],this.callbacks[t].push(e)}merge(t){if("object"==typeof t)for(let e in t)"attributes"===e?this.processAttributes(t.attributes):this[e]=t[e];else console.log("EL.merge(): Given model is not a valid object")}processAttributes(t){for(let e in t)"innerHTML"!==e?this.el.setAttribute(e,t[e]):"innerHTML"===e&&(this.el.innerHTML=t[e])}open(){this.status=STATUS.OPEN;try{this.node.open()}catch(t){console.log("Unable to open parent element("+this.element+")",t)}return this}close(){return this.status=STATUS.CLOSED,this}empty(){for(;this.el.firstChild;)this.el.removeChild(this.el.firstChild);return this}destroy(t=300){try{setTimeout(function(){this.el.parentNode.removeChild(this.el)}.bind(this),t);try{let t=this.node.children.indexOf(this);this.node.children.splice(t,1)}catch(t){console.log("Unable to remove "+this.element+" from node.children")}}catch(t){console.log("Unable to destroy this "+this.element,t)}return this}setClass(t){return this.el.className=t,this.attributes.class=t,this}addClass(t){$(this.el).addClass(t);let e=this.attributes.class||"";return this.attributes.class=e+" "+t,this}removeClass(t){return $(this.el).removeClass(t),this.attributes.set("class",this.attributes.get("class").replace(t,"")),this}show(){return this.el.style.display="block",this}hide(){return this.el.style.display="none",this}activate(){return $(this.el).addClass("active"),this}deactivate(){return $(this.el).removeClass("active"),this}toggle(t){return t?$(this.el).toggleClass(t):$(this.el).toggle(),this}populate(t){if(t)try{for(let e=0;e<t.length;e++)this.create(t[e])}catch(t){console.log(t)}return this}setInnerHTML(t=""){return this.el.innerHTML=t,this}scrollTo(t=1e3){return console.log("Scrolling to this element at "+parseInt($(this.el).offset().top)),$(this.node.el).animate({scrollTop:parseInt($(this.el).offset().top)},t),this}}export{MODEL,ATTRIBUTES};
//# sourceMappingURL=EL.js.map
