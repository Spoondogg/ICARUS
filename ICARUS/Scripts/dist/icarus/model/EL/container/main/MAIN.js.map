{"version":3,"sources":["icarus/model/EL/container/main/MAIN.js"],"names":["CONTAINER","ATTRIBUTES","DIALOG","FORM","ICONS","INPUTTYPES","MODEL","FORMINPUT","LOADER","NAVITEMICON","PROMPT","SIDEBAR","STICKYFOOTER","MAIN","[object Object]","model","document","title","label","super","body","this","addClass","navBar","pane","factory","loader","token","url","sidebar","set","addNavOptions","stickyFooter","populate","children","showNavBar","user","btnLogin","header","tabs","addNavItem","icon","USER","anchor","el","onclick","login","bind","dev","menu","btnSidebar","toggleSidebar","$","insertBefore","tab","focusBody","addDefaultMenuItems","addNavItemIcon","userMenu","addMenu","name","showHeader","collapsed","toggleCollapse","logout","OPTIONS","domMenu","getGroup","HOME","setTimeout","location","href","origin","TOGGLE","toggleHeaders","CONSOLE","show","showConsole","REFRESH","reload","crudMenu","newMain","getJSON","payload","console","log","hasClass","removeClass","collapse","id","returnUrl","searchParams","get","loadAjaxCall","data","result","empty","setId","setLabel","e","className","message","toggle","text","prompt","form","setPostUrl","setAttribute","email","fieldset","formElementGroup","typeId","INPUT","type","password","PASSWORD","footer","buttonGroup","post","serialize","ajaxRefreshIfSuccessful","addButton","register","externalLogin","createExternalLoginForm","provider","createEmptyForm","container","style","display","__RequestVerificationToken"],"mappings":"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","file":"MAIN.js","sourcesContent":["/**\r\n    @module\r\n*/\r\nimport CONTAINER, { ATTRIBUTES, DIALOG, FORM, ICONS, INPUTTYPES, MODEL } from '../CONTAINER.js';\r\n//import CONTAINERFACTORY from '../../../../controller/CONTAINERFACTORY.js';\r\nimport FORMINPUT from '../formelement/forminput/FORMINPUT.js';\r\nimport LOADER from '../../modal/loader/LOADER.js';\r\nimport NAVITEMICON from '../../nav/navitemicon/NAVITEMICON.js';\r\nimport PROMPT from '../../modal/prompt/PROMPT.js';\r\nimport SIDEBAR from '../sidebar/SIDEBAR.js';\r\nimport STICKYFOOTER from '../../footer/stickyfooter/STICKYFOOTER.js';\r\n/**\r\n    A top level View that holds all other child Containers\r\n    @class\r\n    @extends CONTAINER\r\n*/\r\nexport default class MAIN extends CONTAINER {\r\n\t/**\r\n\t    Constructs a MAIN Container and populates the DOM\r\n\t    with any relevant elements\r\n\t    @constructor\r\n\t    @param {MODEL} model APP model\r\n\t */\r\n\tconstructor(model) {\r\n\t\tdocument.title = model.label;\r\n\t\tsuper(document.body, 'MAIN', model, ['ARTICLE', 'INDEX', 'INDEXMAIN', 'CLASSVIEWER', 'IMAGEGALLERY', 'DICTIONARY', 'WORD']);\r\n\t\tthis.addClass('app').navBar.addClass('navbar-fixed-top');\r\n\t\tthis.body.pane.addClass('pane-tall');\r\n\t\t/**\r\n\t\t    @type {CONTAINERFACTORY}\r\n\t\t*/\r\n\t\tthis.factory = model.factory;\r\n\t\t/**\r\n\t\t    @type {LOADER}\r\n\t\t*/\r\n\t\tthis.loader = model.loader;\r\n\t\t/**\r\n\t\t    A Security token\r\n\t\t    @type {string}\r\n\t\t*/\r\n\t\tthis.token = model.token;\r\n\t\t/**\r\n\t\t    Browser Url\r\n\t\t    @property {Url} url The browser url\r\n\t\t*/\r\n\t\tthis.url = model.url;\r\n\t\t/**\r\n\t\t    A Sidebar for details and navigation\r\n\t\t    @property {SIDEBAR} sidebar A Sidebar that exists at the top level of the MAIN Container\r\n\t\t*/\r\n\t\tthis.sidebar = new SIDEBAR(this, new MODEL().set({ 'label': 'Left Sidebar' }));\r\n\t\tthis.addNavOptions();\r\n\t\tthis.stickyFooter = new STICKYFOOTER(this, new MODEL());\r\n\t\tthis.populate(model.children);\r\n\t}\r\n\tconstruct() {\r\n\t\tthis.showNavBar();\r\n\t\tif (this.user === 'Guest') {\r\n\t\t\tthis.btnLogin = this.navBar.header.tabs.addNavItem( //this.tabs.addNavItem(\r\n\t\t\t\tnew MODEL('pull-right').set({\r\n\t\t\t\t\t'icon': ICONS.USER,\r\n\t\t\t\t\t'anchor': new MODEL().set({\r\n\t\t\t\t\t\t'icon': ICONS.USER //,\r\n\t\t\t\t\t\t//'label': '',\r\n\t\t\t\t\t\t//'url': '#'\r\n\t\t\t\t\t})\r\n\t\t\t\t}));\r\n\t\t\tthis.btnLogin.el.onclick = this.login.bind(this);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t    Returns the Application Dev setting\r\n\t    @todo Move this into a config\r\n\t    @returns {boolean} Returns true if app in dev mode\r\n\t*/\r\n\tisDev() {\r\n\t\treturn this.dev;\r\n\t}\r\n\t/**\r\n\t    Returns a friendly username for the current user (if exists)\r\n\t    @returns {string} A friendly username\r\n\t*/\r\n\tgetUser() {\r\n\t\treturn this.user;\r\n\t}\r\n\t/**\r\n\t    Returns the MAIN Token\r\n\t    @returns {string} A Session Token\r\n\t*/\r\n\tgetToken() {\r\n\t\treturn this.token;\r\n\t}\r\n\t/**\r\n\t    Returns the MAIN Factory\r\n\t    @returns {CONTAINERFACTORY} The Main Container Factory\r\n\t*/\r\n\tgetFactory() {\r\n\t\treturn this.factory;\r\n\t}\r\n\t/**\r\n\t\t    Add items to Options Dropdown Tab\r\n\t        @returns {ThisType} Returns this MAIN for method chaining\r\n\t\t */\r\n\taddNavOptions() {\r\n\t\tif (this.navBar.header.menu) {\r\n\t\t\t/** A NavItem that toggles the visibility of the Sidebar */\r\n\t\t\tthis.btnSidebar = this.navBar.header.tabs.addNavItem(new MODEL('pull-left').set({\r\n\t\t\t\t'anchor': new MODEL().set({\r\n\t\t\t\t\t'icon': ICONS.SIDEBAR //,\r\n\t\t\t\t\t//'label': '',\r\n\t\t\t\t\t//'url': '#'\t\t\t\t\t\r\n\t\t\t\t})\r\n\t\t\t}));\r\n\t\t\tthis.btnSidebar.el.onclick = this.toggleSidebar.bind(this);\r\n\t\t\t$(this.btnSidebar.el).insertBefore(this.navBar.header.tab.el);\r\n\t\t\tthis.body.el.onclick = this.focusBody.bind(this); // Hide Sidebar when container body is focused\r\n\t\t\tthis.addDefaultMenuItems();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t/**\r\n\t    Adds a NavItemIcon to the given menu with the given params\r\n\t    @param {MENU} menu A navigation MENU\r\n\t    @param {string} icon An Icon reference\r\n\t    @param {string} label The displayed text\r\n\t    @param {string} url The optional url that this Nav Item references \r\n\t    @returns {NAVITEMICON} A Nav Item with an Icon and optional label\r\n\t */\r\n\taddNavItemIcon(menu, icon, label = '', url = '#') {\r\n\t\tmenu.addNavItemIcon(new MODEL().set({\r\n\t\t\t'anchor': new MODEL().set({\r\n\t\t\t\ticon,\r\n\t\t\t\tlabel,\r\n\t\t\t\turl\r\n\t\t\t})\r\n\t\t}))\r\n\t}\r\n\t/**\r\n\t    Adds the default User, Crud and Dom menus to this Container\r\n\t    @returns {void}\r\n\t*/\r\n\taddDefaultMenuItems() {\r\n\t\t// Add USER options\r\n\t\tlet userMenu = this.navBar.header.menu.addMenu(new MODEL(new ATTRIBUTES('horizontal collapse')).set({\r\n\t\t\t'name': 'USER',\r\n\t\t\t'showHeader': 1,\r\n\t\t\t'collapsed': 1\r\n\t\t}));\r\n\t\tthis.addNavItemIcon(userMenu, ICONS.USER, 'Log Out', '#?url=logout').el.onclick = () => {\r\n\t\t\tthis.navBar.header.toggleCollapse();\r\n\t\t\tthis.logout();\r\n\t\t};\r\n\t\t/*\r\n\t\tuserMenu.addNavItemIcon(new MODEL().set({\r\n\t\t    'anchor': new MODEL().set({\r\n\t\t        'icon': ICONS.USER,\r\n\t\t        'label': 'Log Out',\r\n\t\t        'url': '#?url=logout'\r\n\t\t    })\r\n\t\t})).el.onclick = () => {\r\n\t\t    this.navBar.header.toggleCollapse();\r\n\t\t    this.logout();\r\n\t\t};\r\n\t\t*/\r\n\t\tthis.addNavItemIcon(userMenu, ICONS.OPTIONS, 'Manage', 'Manage/Index');\r\n\t\t/*\r\n\t\tuserMenu.addNavItemIcon(new MODEL().set({\r\n\t\t    'anchor': new MODEL().set({\r\n\t\t        'icon': ICONS.OPTIONS,\r\n\t\t        'label': 'Manage',\r\n\t\t        'url': 'Manage/Index'\r\n\t\t    })\r\n\t\t}));\r\n\t\t*/\r\n\t\tlet domMenu = this.navBar.header.menu.getGroup('DOM');\r\n\t\tthis.addNavItemIcon(domMenu, ICONS.HOME, 'Home').el.onclick = () => {\r\n\t\t\t//console.log(100, 'Returning Home...');\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tlocation.href = this.url.origin;\r\n\t\t\t}, 300);\r\n\t\t};\r\n\t\t/*\r\n\t\tdomMenu.addNavItemIcon(new MODEL().set({\r\n\t\t    'anchor': new MODEL().set({\r\n\t\t        'icon': ICONS.HOME,\r\n\t\t        'label': 'Home'\r\n\t\t    })\r\n\t\t})).el.onclick = () => {\r\n\t\t    //console.log(100, 'Returning Home...');\r\n\t\t    setTimeout(() => {\r\n\t\t        location.href = this.url.origin;\r\n\t\t    }, 1000);\r\n\t\t};\r\n\t\t*/\r\n\t\tthis.addNavItemIcon(domMenu, ICONS.TOGGLE, 'Headers').el.onclick = () => {\r\n\t\t\tthis.toggleHeaders();\r\n\t\t\tthis.navBar.header.toggleCollapse();\r\n\t\t};\r\n\t\t/*\r\n\t\tdomMenu.addNavItemIcon(new MODEL().set({\r\n\t\t    'anchor': new MODEL().set({\r\n\t\t        'icon': ICONS.TOGGLE,\r\n\t\t        'label': 'Headers'\r\n\t\t    })\r\n\t\t})).el.onclick = () => {\r\n\t\t    this.toggleHeaders();\r\n\t\t    this.navBar.header.toggleCollapse();\r\n\t\t};\r\n\t\t*/\r\n\t\tthis.addNavItemIcon(domMenu, ICONS.CONSOLE, 'Console').el.onclick = () => {\r\n\t\t\t//console.log('Showing Console');\r\n\t\t\tthis.loader.show();\r\n\t\t\tthis.loader.showConsole();\r\n\t\t};\r\n\t\t/*\r\n\t\tdomMenu.addNavItemIcon(new MODEL().set({\r\n\t\t    'anchor': new MODEL().set({\r\n\t\t        'icon': ICONS.CONSOLE,\r\n\t\t        'label': 'Console'\r\n\t\t    })\r\n\t\t})).el.onclick = () => {\r\n\t\t    //console.log('Showing Console');\r\n\t\t    this.loader.show();\r\n\t\t    this.loader.showConsole();\r\n\t\t};*/\r\n\t\tthis.addNavItemIcon(domMenu, ICONS.REFRESH, 'Reload').el.onclick = () => {\r\n\t\t\t//console.log(100, 'Reloading');\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tlocation.reload(true);\r\n\t\t\t}, 1000);\r\n\t\t};\r\n\t\t/*\r\n\t\tdomMenu.addNavItemIcon(new MODEL().set({\r\n\t\t    'anchor': new MODEL().set({\r\n\t\t        'icon': ICONS.REFRESH,\r\n\t\t        'label': 'Reload'\r\n\t\t    })\r\n\t\t})).el.onclick = () => {\r\n\t\t    //console.log(100, 'Reloading');\r\n\t\t    setTimeout(() => {\r\n\t\t        location.reload(true);\r\n\t\t    }, 1000);\r\n\t\t};\r\n\t\t*/\r\n\t\tlet crudMenu = this.navBar.header.menu.getGroup('CRUD');\r\n\t\tthis.addNavItemIcon(crudMenu, ICONS.MAIN, 'New').el.onclick = this.newMain.bind(this);\r\n\t\t/*\r\n\t\tcrudMenu.addNavItemIcon(new MODEL().set({\r\n\t\t    'anchor': new MODEL().set({\r\n\t\t        'icon': ICONS.MAIN,\r\n\t\t        'label': 'New'\r\n\t\t    })\r\n\t\t})).el.onclick = this.newMain.bind(this);*/\r\n\t}\r\n\t/**\r\n\t\t    Requests a new {@link MAIN} from the server and \r\n\t\t    redirects to that page\r\n\r\n\t\t    @todo This should be a POST to avoid CSRF\r\n\t        @returns {Promise<boolean>} Promised to return true if new MAIN created successfully\r\n\t\t*/\r\n\tnewMain() {\r\n\t\t$.getJSON('/MAIN/Get/0', (payload) => {\r\n\t\t\tconsole.log('Created MAIN', payload);\r\n\t\t\t/**\r\n\t\t\t    Prompts the user to open the new page.\r\n\t\t\t    In order to avoid popup blocking, the user must \r\n\t\t\t    manually click to be redirected or launch a new\r\n\t\t\t    page in this window\r\n\t\t\t\t\t\t\r\n\t\t\tlet url = '/' + payload.model.id;\r\n\t\t\tlet prompt = new PROMPT('New Page', 'A new page has been created at <a href=\"' + url + '\" target=\"_blank\">' + url + '</a>');\r\n\t\t\tlet button = prompt.form.footer.buttonGroup.children[0];\r\n\t\t\tbutton.setLabel('Open in new Window?');\r\n\t\t\tbutton.el.onclick = () => {\r\n\t\t\t\twindow.open(url, '_blank');\r\n\t\t\t\tprompt.hide(300, true);\r\n\t\t\t};\r\n\t\t\tprompt.form.footer.buttonGroup.addButton('Open in this Window?').el.onclick = () => {\r\n\t\t\t\tlocation.href = url;\r\n\t\t\t\tprompt.hide(300, true);\r\n\t\t\t};\r\n\t\t\tprompt.show();*/\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\t/**\r\n\t    Overrides CONTAINER.getContainer() and returns this MAIN Container\r\n\t    @returns {MAIN} The MAIN Container\r\n\t*/\r\n\tgetContainer() {\r\n\t\treturn this;\r\n\t}\r\n\t/**\r\n\t    Overrides CONTAINER.getMainContainer() and returns this MAIN Container\r\n\t    @returns {MAIN} The MAIN Container\r\n\t*/\r\n\tgetMainContainer() {\r\n\t\treturn this;\r\n\t}\r\n\t/**\r\n\t\t    Sets the focus on the Main container body.  \r\n\t\t    This generally is used to hide elements such \r\n\t\t    as a Sidebar, Modal or an EDIT pane\r\n\t        @returns {void}\r\n\t\t */\r\n\tfocusBody() {\r\n\t\tif ($(this.sidebar.el).hasClass('active')) {\r\n\t\t\tthis.sidebar.removeClass('active');\r\n\t\t}\r\n\t\t$(this.navBar.header.menu.el).collapse('hide');\r\n\t}\r\n\t/**\r\n\t\t    Loads the specified app id into the Main Container\r\n\r\n\t        @todo Prompt the user for an Id to load\r\n\t        @todo create a simple application browser to retrieve a MAIN\r\n\r\n\t\t    @param {number} id App Id to load\r\n\t\t    @returns {MAIN} This MAIN\r\n\t\t*/\r\n\tload(id = 1) {\r\n\t\tlet returnUrl = this.url.searchParams.get('ReturnUrl');\r\n\t\tif (returnUrl) {\r\n\t\t\treturnUrl = this.url.origin + returnUrl;\r\n\t\t\tlocation.href = returnUrl;\r\n\t\t}\r\n\t\t$.getJSON('Main/Get/' + id, this.loadAjaxCall.bind(this));\r\n\t\treturn this;\r\n\t}\r\n\t/**\r\n\t\t    The ajax call performed when MAIN.load is called\r\n\t\t    Receives the MAIN model from Main/Get/id (if permitted)\r\n\t\t    Then, sets the document title, application id and label\r\n\t\t    and Populates accordingly\r\n\t\t    @param {any} data The ajax payload\r\n\t        @returns {boolean} True on success\r\n\t        @throws Throws an error if unable to construct given class\r\n\t\t*/\r\n\tloadAjaxCall(data) {\r\n\t\tif (data.result === 1) {\r\n\t\t\ttry {\r\n\t\t\t\tif (data.model.label) {\r\n\t\t\t\t\tdocument.title = data.model.label;\r\n\t\t\t\t}\r\n\t\t\t\tthis.body.pane.empty();\r\n\t\t\t\tthis.setId(this.id);\r\n\t\t\t\tthis.setLabel(data.model.label);\r\n\t\t\t\tthis.populate(data.model.children);\r\n\t\t\t\treturn true;\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log(0, 'Unable to construct ' + this.className + '(' + this.id + ')');\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.loader.log(0, 'Failed to retrieve ' + this.className + '(' + this.id + ') from server\\n' + data.message);\r\n\t\t\tthis.loader.showConsole();\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t\t    Toggles the active state of the sidebar\r\n\t        @return {ThisType} Return this for method chain\r\n\t\t */\r\n\ttoggleSidebar() {\r\n\t\tthis.sidebar.toggle('active');\r\n\t\treturn this;\r\n\t}\r\n\t/**\r\n\t\t    Made obsolete by EL.merge()\r\n\t\t    @param {any} payload Data returned by server\r\n\t        @deprecated\r\n\t        @returns {void}\r\n\t\t \r\n\tupdateModel(payload) {\r\n\t\tthis.setLabel(payload.label);\r\n\t\tthis.setSubSections(payload.subsections);\r\n\t}*/\r\n\t/**\r\n\t\t    Allows the user to open a MAIN \r\n\t\t    @param {number} id MAIN id\r\n\t        @todo Create method to browse MAINs\r\n\t        @returns {boolean} True on success\r\n\t\t*/\r\n\topen(id = 0) {\r\n\t\tconsole.log('TODO: APP.open(' + id + ')');\r\n\t\treturn false;\r\n\t}\r\n\t/**\r\n\t    Returns the APP Id\r\n\t    @returns {number} App Id\r\n\t*/\r\n\tgetId() {\r\n\t\treturn this.id;\r\n\t}\r\n\t/**\r\n\t\t    Launches the External Authentication Process\r\n\t\t    The user will be redirected to a third party authenticator\r\n\t        @returns {void}\r\n\t\t*/\r\n\tloginExternal() {\r\n\t\tconsole.log('loginExternal()');\r\n\t\t/*\r\n\t\t\t\tconsole.log('Log In - External OAuth Provider');\r\n\t\t\t\tthis.prompt = new PROMPT('Log In - OAuth', '', [], [], true);\r\n\t\t\t\tthis.prompt.addClass('prompt');\r\n\t\t\t\tthis.prompt.form.postUrl = '/Account/ExternalLogin';\r\n\t\t\t\tthis.prompt.form.provider = new EL(this.prompt.form.fieldset.formElementGroup.body.pane, 'INPUT', new MODEL(new ATTRIBUTES({\r\n\t\t\t\t\t'type': 'hidden',\r\n\t\t\t\t\t'name': 'provider'\r\n\t\t\t\t})));\r\n\t\t\t\tthis.prompt.form.returnUrl = new EL(this.prompt.form.fieldset.formElementGroup.body.pane, 'INPUT', new MODEL(new ATTRIBUTES({\r\n\t\t\t\t\t'type': 'hidden',\r\n\t\t\t\t\t'name': 'ReturnUrl'\r\n\t\t\t\t})));\r\n\t\t\t\tthis.prompt.form.destroy(0);\r\n\t\t\t\t// Create a new form to submit 3rd party logins\r\n\t\t\t\tthis.externalLogin = FORM.createEmptyForm(this.prompt.container.body.pane);\r\n\t\t\t\tthis.externalLogin.el.setAttribute('method', 'post');\r\n\t\t\t\tthis.externalLogin.el.setAttribute('action', '/Account/ExternalLogin?ReturnUrl=%2F');\r\n\t\t\t\tthis.externalLogin.footer.buttonGroup.children[0].el.style.display = 'none';\r\n\t\t\t\tthis.provider = new EL(this.externalLogin.fieldset.formElementGroup.body.pane, 'INPUT', new MODEL(new ATTRIBUTES({\r\n\t\t\t\t\t'type': 'hidden',\r\n\t\t\t\t\t'name': 'provider'\r\n\t\t\t\t})));\r\n\t\t\t\tthis.returnUrl = new EL(this.externalLogin.fieldset.formElementGroup.body.pane, 'INPUT', new MODEL(new ATTRIBUTES({\r\n\t\t\t\t\t'type': 'hidden',\r\n\t\t\t\t\t'name': 'ReturnUrl'\r\n\t\t\t\t})));\r\n\t\t\t\tlet btnOAuth = this.externalLogin.footer.buttonGroup.addButton('OAuth - Google');\r\n\t\t\t\tbtnOAuth.el.onclick = () => {\r\n\t\t\t\t\tconsole.log(50, 'Launching OAuth2 Authenticator...');\r\n\t\t\t\t\t//let url = new URL(window.location.href);\r\n\t\t\t\t\tlet returnUrl = this.url.origin + '/signin-google';\r\n\t\t\t\t\tthis.returnUrl.el.setAttribute('value', returnUrl);\r\n\t\t\t\t\tlet provider = 'Google';\r\n\t\t\t\t\tthis.provider.el.setAttribute('value', provider);\r\n\t\t\t\t\tlet postUrl = '/Account/ExternalLogin/externalLogin?provider=' + provider + '&returnUrl=' + encodeURI(returnUrl);\r\n\t\t\t\t\tlocation.href = postUrl;\r\n\t\t\t\t};\r\n\t\t\t\tthis.prompt.show();\r\n\t\t        */\r\n\t}\r\n\t/**\r\n\t\t    Log into the application using the given credentials\r\n\t\t    param {string} email Username / Email \r\n\t\t    param {string} password Account Password\r\n\t        @todo Consider handling email/password string or CREDENTIALS object\r\n\t        @todo Create INPUT CHECKBOX called 'RememberMe'\r\n\t        @todo Create BUTTON to launch 'Register as new User\r\n\t        @todo Create AHREF to 'ForgotPassword'\r\n\t        @returns {void}\r\n\t\t*/\r\n\tlogin() { //email, password\r\n\t\tlet dialog = new DIALOG(new MODEL().set({ 'text': 'woot' })); //'token': this.getMainContainer().getToken()\r\n\t\tdialog.show();\r\n\t\tthis.prompt = new PROMPT('Log In', '', [], [], true);\r\n\t\tthis.prompt.addClass('prompt');\r\n\t\tthis.prompt.form.setPostUrl('/Account/Login');\r\n\t\tthis.prompt.form.el.setAttribute('class', 'login');\r\n\t\tthis.prompt.form.el.setAttribute('method', 'POST');\r\n\t\tthis.prompt.form.el.setAttribute('action', '#');\r\n\t\tthis.email = new FORMINPUT(this.prompt.form.fieldset.formElementGroup.body.pane, new MODEL(new ATTRIBUTES({\r\n\t\t\t'typeId': INPUTTYPES.INPUT,\r\n\t\t\t'type': 'Email',\r\n\t\t\t'name': 'Email'\r\n\t\t})).set({\r\n\t\t\t'label': 'Username',\r\n\t\t\t'showHeader': 0\r\n\t\t}));\r\n\t\tthis.password = new FORMINPUT(this.prompt.form.fieldset.formElementGroup.body.pane, new MODEL(new ATTRIBUTES({\r\n\t\t\t'typeId': INPUTTYPES.PASSWORD,\r\n\t\t\t'type': 'Password',\r\n\t\t\t'name': 'Password'\r\n\t\t})).set({\r\n\t\t\t'label': 'Password',\r\n\t\t\t'showHeader': 0\r\n\t\t}));\r\n\t\t//this.prompt.form.footer.buttonGroup.children[0].el.style.display = 'none';\r\n\t\t/**\r\n\t\t\tPost the Login FormPost\r\n\t\t\tIf login successful, load the new User Session (Refresh Page)\r\n\t\t    @returns {void}\r\n\t\t*/\r\n\t\tthis.prompt.form.footer.buttonGroup.children[0].el.onclick = () => {\r\n\t\t\t$.post('/Account/LogIn', $(this.prompt.form.el).serialize(), this.ajaxRefreshIfSuccessful);\r\n\t\t};\r\n\t\tthis.prompt.form.footer.buttonGroup.addButton('Register').el.onclick = this.register;\r\n\t\t// Create a new form to submit 3rd party logins\r\n\t\tthis.externalLogin = this.createExternalLoginForm();\r\n\t\tthis.provider = new FORMINPUT(this.externalLogin.fieldset.formElementGroup.body.pane, new MODEL(new ATTRIBUTES({\r\n\t\t\t'type': 'hidden',\r\n\t\t\t'name': 'provider'\r\n\t\t})));\r\n\t\tthis.returnUrl = new FORMINPUT(this.externalLogin.fieldset.formElementGroup.body.pane, new MODEL(new ATTRIBUTES({\r\n\t\t\t'type': 'hidden',\r\n\t\t\t'name': 'returnUrl'\r\n\t\t})));\r\n\t\tlet btnOAuth = this.externalLogin.footer.buttonGroup.addButton('OAuth');\r\n\t\tbtnOAuth.el.onclick = function() {\r\n\t\t\tconsole.log(50, 'Launching OAuth2 Authenticator...');\r\n\t\t\t/*\r\n\t\t\t\t\t\tlet returnUrl = this.url.origin + '/signin-google';\r\n\t\t\t\t\t\tthis.returnUrl.el.setAttribute('value', returnUrl);\r\n\t\t\t            \r\n\t\t\t\t\t\tlet provider = 'Google';\r\n\t\t\t\t\t\tthis.provider.el.setAttribute('value', provider);\r\n\t\t\t            \r\n\r\n\t\t\t\t\t\tlet postUrl = '/Account/ExternalLogin?provider='\r\n\t\t\t\t\t\t    + provider + '&returnUrl=' + encodeURI(returnUrl); \r\n\t\t\t\t\t\t*/\r\n\t\t\tlocation.href = '/Account/ExternalLogin';\r\n\t\t\t/****            \r\n\t\t\t<form action=\"/Account/ExternalLogin?ReturnUrl=%2F\" method=\"post\">\r\n\t\t\t    <input name=\"__RequestVerificationToken\" type=\"hidden\" value=\"NUl4K_C0ubvHbrEeyfF19jddMf9-BZ-MTIuA33kSxdhMJoh5TEvV53sbv61vtRCp_vbWI2DQzFENnljDRpx2srlaBpQZQRsWZoKkLwSjTek1\">                <div id=\"socialLoginList\">\r\n\t\t\t    <p>\r\n\t\t\t        <button type=\"submit\" \r\n\t\t\t            class=\"btn btn-default\" id=\"Google\" \r\n\t\t\t            name=\"provider\" value=\"Google\" \r\n\t\t\t            title=\"Log in using your Google account\"\r\n\t\t\t        >Google</button>\r\n\t\t\t    </p>\r\n\t\t\t    </div>\r\n\t\t\t</form>\r\n\t\t\t****/\r\n\t\t};\r\n\t\tthis.prompt.show();\r\n\t}\r\n\t/**\r\n\t    Sets up the External Login Form\r\n\t    @returns {FORM} An external login form\r\n\t*/\r\n\tcreateExternalLoginForm() {\r\n\t\tlet externalLogin = FORM.createEmptyForm(this.prompt.container.body.pane);\r\n\t\texternalLogin.el.setAttribute('method', 'post');\r\n\t\texternalLogin.el.setAttribute('action', '/Account/ExternalLogin');\r\n\t\texternalLogin.footer.buttonGroup.children[0].el.style.display = 'none';\r\n\t\treturn externalLogin;\r\n\t}\r\n\t/**\r\n\t\t    Logs the current user out\r\n\t        @returns {Promise<boolean>} True on success\r\n\t\t*/\r\n\tlogout() {\r\n\t\tthis.loader.showConsole();\r\n\t\tthis.loader.log(50, 'MAIN.logout(); Logging out...', true);\r\n\t\t$.post('/Account/LogOff', {\r\n\t\t\t'__RequestVerificationToken': this.token\r\n\t\t}, this.ajaxRefreshIfSuccessful, \"json\");\r\n\t}\r\n\t/**\r\n\t\t    Log into the application using the given credentials\r\n\t\t    @param {string} email Username / Email \r\n\t\t    @param {string} password Account Password\r\n\t        @returns {void}\r\n\t\t*/\r\n\tregister() {\r\n\t\tconsole.log('Register');\r\n\t\t/*this.prompt = new PROMPT('Register', '', [], [], true);\r\n\t\t\t\tthis.prompt.addClass('prompt');\r\n\t\t\t\tthis.prompt.form.setPostUrl('/Account/Register');\r\n\t\t\t\tthis.prompt.form.el.setAttribute('class', 'register');\r\n\t\t\t\t//this.prompt.form.el.setAttribute('method', 'POST');\r\n\t\t\t\t//this.prompt.form.el.setAttribute('action', 'Account/Register');\r\n\t\t\t\tthis.prompt.form.postUrl = \"Account/Register\";\r\n\t\t\t\t//this.email = new INPUT(this.prompt.formElementGroup.body.pane,\r\n\t\t\t\tthis.email = new FORMINPUT(this.prompt.form.fieldset.formElementGroup.body.pane, new MODEL(new ATTRIBUTES({\r\n\t\t\t\t\t'typeId': INPUTTYPES.INPUT,\r\n\t\t\t\t\t'type': 'Email',\r\n\t\t\t\t\t'name': 'email'\r\n\t\t\t\t})).set({\r\n\t\t\t\t\t'label': 'Username',\r\n\t\t\t\t\t'showHeader': 0\r\n\t\t\t\t}));\r\n\t\t\t\tthis.password = new FORMINPUT(this.prompt.form.fieldset.formElementGroup.body.pane, new MODEL(new ATTRIBUTES({\r\n\t\t\t\t\t'typeId': INPUTTYPES.PASSWORD,\r\n\t\t\t\t\t'type': 'Password',\r\n\t\t\t\t\t'name': 'password'\r\n\t\t\t\t})).set({\r\n\t\t\t\t\t'label': 'Password',\r\n\t\t\t\t\t'showHeader': 0\r\n\t\t\t\t}));\r\n\t\t\t\tthis.passwordConfirm = new FORMINPUT(this.prompt.form.fieldset.formElementGroup.body.pane, new MODEL(new ATTRIBUTES({\r\n\t\t\t\t\t'typeId': INPUTTYPES.PASSWORD,\r\n\t\t\t\t\t'type': 'Password',\r\n\t\t\t\t\t'name': 'PasswordConfirm'\r\n\t\t\t\t})).set({\r\n\t\t\t\t\t'label': 'Confirm Password',\r\n\t\t\t\t\t'showHeader': 0\r\n\t\t\t\t}));\r\n\t\t\t\tthis.prompt.form.afterSuccessfulPost = function(payload) {\r\n\t\t\t\t\tthis.prompt.form.ajaxRefreshIfSuccessful(payload, 'success');\r\n\t\t\t\t\tthis.prompt.hide();\r\n\t\t\t\t}.bind(this);\r\n\t\t\t\tthis.prompt.show();\r\n\t\t        */\r\n\t}\r\n\t/**\r\n\t\t    Call an external registration form\r\n\t\t    param {string} email Username / Email \r\n\t        @returns {void}\r\n\t\t*/\r\n\tregisterExternal() { // email\r\n\t\tconsole.log('Register External Login');\r\n\t\t/*this.prompt = new PROMPT('Associate your OAuth2 Id', '', [], [], true);\r\n\t\tthis.prompt.form.destroy();\r\n\t\tlet tmp = new DIV(this.prompt.container.body.pane, new MODEL());\r\n\t\t$(document.getElementById('externalLoginConfirmation')).insertBefore(tmp.el);\r\n\t\ttmp.destroy();\r\n\t\tthis.prompt.show();*/\r\n\t}\r\n}\r\nexport { LOADER, MODEL, NAVITEMICON };"]}