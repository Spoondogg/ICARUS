{"version":3,"sources":["model/EL/container/banner/indexmain/INDEXMAIN.js"],"names":["BANNER","BUTTON","BUTTONGROUP","FOOTER","HEADER","MENU","MODEL","THUMBNAIL","INDEXMAIN","[object Object]","node","model","super","this","addClass","page","pageLength","pageTotal","menu","set","label","header","$","el","insertBefore","body","pane","pagination","createPaginationFooter","footer","insertAfter","loadPage","isNaN","console","log","post","__RequestVerificationToken","getMainContainer","token","payload","status","total","list","forEach","obj","createThumbnail","className","buttonGroup","loaded","pageCount","Math","ceil","p","addButton","onclick","name","thumb","dataId","data","id","index","launchMain","setAttribute","btnPrev","prevPage","bind","btnNext","nextPage","returnUrl","url","searchParams","get","origin","location","href","getJSON","loadAjaxCall","setInnerHTML","buttons","children","b","length","removeClass","empty","construct","e"],"mappings":"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","file":"INDEXMAIN.js","sourcesContent":["/** @module */\r\nimport BANNER from '../BANNER.js';\r\nimport BUTTON from '../../../button/BUTTON.js';\r\nimport BUTTONGROUP from '../../../group/buttongroup/BUTTONGROUP.js';\r\nimport FOOTER from '../../../footer/FOOTER.js';\r\nimport HEADER from '../../../header/HEADER.js';\r\n//import IFRAME from '../../iframe/IFRAME.js';\r\nimport MENU from '../../../nav/menu/MENU.js';\r\n//import MODAL from '../../../modal/MODAL.js';\r\nimport MODEL from '../../../../MODEL.js';\r\nimport THUMBNAIL from '../thumbnail/THUMBNAIL.js';\r\n/** Contains a high level view of all MAIN Objects available to this user\r\n    @class\r\n    @extends BANNER\r\n*/\r\nexport default class INDEXMAIN extends BANNER {\r\n\t/** Constructs a banner with a header affixed outside of the Container's pane\r\n        Contents are paged and pagination exists in the footer\r\n        @todo Contents should be grouped in 3's or 4's and cycled through by swiping\r\n        @todo Preload / Stream contents\r\n\t    @param {CONTAINER} node Parent node\r\n\t    @param {MODEL} model INDEX model\r\n\t */\r\n\tconstructor(node, model) {\r\n\t\tsuper(node, model);\r\n\t\tthis.addClass('index-main');\r\n\t\tthis.page = 0;\r\n\t\tthis.pageLength = 6;\r\n\t\tthis.pageTotal = 0;\r\n\t\tthis.menu = new MENU(this, new MODEL().set({ 'label': 'INDEX' }));\r\n\t\tthis.header = new HEADER(this, new MODEL());\r\n\t\t$(this.header.el).insertBefore(this.body.pane.el);\r\n\t\tthis.pagination = this.createPaginationFooter();\r\n\t\tthis.footer = new FOOTER(this, new MODEL());\r\n\t\t$(this.pagination.el).insertAfter(this.body.pane.el);\r\n\t\tthis.loadPage(this.page);\r\n\t}\r\n\t/** Constructs the INDEXMAIN Container\r\n        @returns {void}\r\n    */\r\n\tconstruct() {\r\n\t\tif (!isNaN(this.page)) {\r\n\t\t\tconsole.log('Retrieving page ' + this.page);\r\n\t\t\t$.post('/Main/PageIndex?page=' + this.page + '&pageLength=' + this.pageLength, {\r\n\t\t\t\t'__RequestVerificationToken': this.getMainContainer().token\r\n\t\t\t}, (payload, status) => {\r\n\t\t\t\tif (status === 'success') {\r\n                    this.pageTotal = payload.total;\r\n                    payload.list.forEach((obj) => {\r\n                        this.createThumbnail(obj, payload.className);\r\n                    });\r\n\t\t\t\t\tif (!this.pagination.buttonGroup.loaded) {\r\n\t\t\t\t\t\tconsole.log('Page Total: ' + this.pageTotal + ', Length: ' + this.pageLength);\r\n\t\t\t\t\t\tthis.pageCount = Math.ceil(this.pageTotal / this.pageLength);\r\n\t\t\t\t\t\tconsole.log('PageCount: ' + this.pageCount + ', (' + this.pageTotal / this.pageLength + ')');\r\n\t\t\t\t\t\tfor (let p = 0; p < this.pageCount; p++) {\r\n\t\t\t\t\t\t\tlet btn = this.pagination.buttonGroup.addButton(p + 1);\r\n\t\t\t\t\t\t\tbtn.el.onclick = () => {\r\n\t\t\t\t\t\t\t\tthis.loadPage(p);\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.pagination.buttonGroup.loaded = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n    }\r\n    /** Creates a Thumbnail\r\n        @param {any} obj The Thumbnail model\r\n        @param {string} name The name to launch\r\n        @returns {THUMBNAIL} A thumbnail\r\n    */\r\n    createThumbnail(obj, name) {\r\n        let thumb = new THUMBNAIL(this.body.pane, new MODEL().set({\r\n            'label': obj.label,\r\n            'dataId': -1,\r\n            'data': {\r\n                'header': obj.label,\r\n                'p': 'Launch ' + obj.label + ' (' + obj.id + ')<br>' + name + '[' + obj.index + ']'\r\n            }\r\n        }));\r\n        thumb.el.onclick = () => {\r\n            this.launchMain(obj.id, obj.label);\r\n        };\r\n        //thumb.buttonGroup.removeClass('btn-block');\r\n        //thumb.button.el.onclick = () => {\r\n        //    this.launchMain(obj.id, obj.label);\r\n        //};\r\n        return thumb;\r\n    }\r\n\t/** Creates a Pagination Footer\r\n\t    @returns {FOOTER} A pagination Footer\r\n\t*/\r\n\tcreatePaginationFooter() {\r\n\t\tlet pagination = new FOOTER(this, new MODEL('pagination'));\r\n\t\tpagination.el.setAttribute('style', 'text-align:center;');\r\n\t\tpagination.btnPrev = new BUTTON(pagination, 'Prev');\r\n\t\tpagination.btnPrev.el.setAttribute('style', 'margin-right:1em;');\r\n\t\tpagination.btnPrev.el.onclick = this.prevPage.bind(this);\r\n\t\tpagination.buttonGroup = new BUTTONGROUP(pagination);\r\n\t\tpagination.buttonGroup.loaded = false;\r\n\t\tpagination.btnNext = new BUTTON(pagination, 'Next');\r\n\t\tpagination.btnNext.el.setAttribute('style', 'margin-left:1em;');\r\n\t\tpagination.btnNext.el.onclick = this.nextPage.bind(this);\r\n\t\treturn pagination;\r\n\t}\r\n    /** Opens the given Main Id in a new window\r\n\t\t@param {number} id Main Container Id\r\n\t    @returns {void}\r\n\t*/\r\n    launchMain(id) {\r\n        //this.getMainContainer().load(id);\r\n        let returnUrl = this.url.searchParams.get('ReturnUrl');\r\n        if (returnUrl) {\r\n            returnUrl = this.url.origin + returnUrl;\r\n            location.href = returnUrl;\r\n        }\r\n        $.getJSON('Main/Get/' + id, this.loadAjaxCall.bind(this));\r\n        return this;\r\n    }\r\n    /** Loads the page\r\n\t    @param {number} page Page to load\r\n\t    @returns {void}\r\n\t*/\r\n\tloadPage(page) {\r\n\t\ttry {\r\n\t\t\tthis.header.setInnerHTML('Page ' + (page + 1));\r\n\t\t\tlet buttons = this.pagination.buttonGroup.el.children;\r\n\t\t\tfor (let b = 0; b < buttons.length; b++) {\r\n\t\t\t\t$(buttons[b]).removeClass('active');\r\n\t\t\t}\r\n\t\t\t//console.log('Activating button[' + page + ']');\r\n\t\t\t$(buttons[page]).addClass('active');\r\n\t\t\tthis.body.pane.empty();\r\n\t\t\tthis.page = page;\r\n\t\t\tthis.construct();\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log('Unable to load page.', e);\r\n\t\t}\r\n\t}\r\n\t/** Loads the next page in sequence\r\n\t    @returns {void}\r\n\t*/\r\n\tnextPage() {\r\n\t\tif (this.pageTotal > this.page * this.pageLength + 1) {\r\n\t\t\tthis.loadPage(this.page + 1);\r\n\t\t} else {\r\n\t\t\tconsole.log('No next pages to display');\r\n\t\t}\r\n\t}\r\n\t/** Loads the previous page\r\n        @returns {void}\r\n    */\r\n\tprevPage() {\r\n\t\tif (this.page > 0) {\r\n\t\t\tthis.loadPage(this.page - 1);\r\n\t\t} else {\r\n\t\t\tconsole.log('No previous pages to display');\r\n\t\t}\r\n\t}\r\n}"]}