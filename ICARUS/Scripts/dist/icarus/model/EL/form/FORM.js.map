{"version":3,"sources":["model/EL/form/FORM.js"],"names":["CONTAINER","ATTRIBUTES","ICONS","INPUTTYPES","MODEL","FIELDSET","FORMFOOTER","FORMINPUT","FORMINPUTTOKEN","FORMPOST","FORM","[object Object]","node","model","super","this","addCase","addFieldset","tokenInput","set","value","getToken","setPostUrl","updateUrl","footer","body","buttonGroup","addButton","SAVE","el","onclick","post","bind","populate","children","push","pane","addGroup","length","hidden","form","style","label","addFormElementGroup","url","postUrl","i","disabled","e","console","log","TypeError","warn","element","elements","type","toUpperCase","htmlEncode","payload","isValid","focus","setAttribute","$","previousSibling","addClass","htmlEncodeValues","formName","name","checkValidity","setInvalid","removeClass","required","checked","selectedIndex","removeAttribute","reset","serializeArray","validate","formPost","getFormPost","lock","ajax","data","xhr","statusText","errorThrown","status","statusCode","response","message","success","unlock","afterSuccessfulPost","getMainContainer","loader","showConsole"],"mappings":"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","file":"FORM.js","sourcesContent":["/** @module */\r\nimport CONTAINER, { ATTRIBUTES, ICONS, INPUTTYPES, MODEL } from '../container/CONTAINER.js';\r\nimport FIELDSET from '../fieldset/FIELDSET.js';\r\n//import FORMELEMENTGROUP from '../container/formelement/FORMELEMENTGROUP.js';\r\nimport FORMFOOTER from './FORMFOOTER.js';\r\nimport FORMINPUT from '../container/formelement/forminput/FORMINPUT.js';\r\nimport FORMINPUTTOKEN from '../container/formelement/forminput/forminputtoken/FORMINPUTTOKEN.js';\r\nimport FORMPOST from './FORMPOST.js';\r\n/** Constructs an Icarus Form Object\r\n    @description An FORM is the underlying form data type for all other page constructors\r\n    and is designed to submit an XML object for Object States.\r\n    @class\r\n    @extends CONTAINER\r\n*/\r\nexport default class FORM extends CONTAINER {\r\n\t/** Constructs a Form for collecting and posting\r\n\t    @param {CONTAINER} node The parent object\r\n\t    @param {MODEL} model The object model\r\n\t */\r\n\tconstructor(node, model) {\r\n\t\tsuper(node, 'FORM', model, ['FIELDSET']);\r\n\t\tthis.addCase('FIELDSET', () => this.addFieldset(model));\r\n\t\tthis.tokenInput = new FORMINPUTTOKEN(this, new MODEL().set({ 'value': this.getToken() }));\r\n\t\tthis.setPostUrl('Form/Submit');\r\n\t\tthis.updateUrl = 'Form/Update';\r\n\t\tthis.footer = new FORMFOOTER(this.body, new MODEL());\r\n\t\tthis.footer.buttonGroup.addButton('Submit', ICONS.SAVE).el.onclick = this.post.bind(this);\r\n\t\tthis.populate(model.children);\r\n\t}\r\n\tconstruct() {}\r\n\t/** Constructs a Fieldset for this FORM\r\n        @todo Verify that this overrides the initial fieldset\r\n\t    @param {MODEL} model Object model\r\n\t    @returns {FIELDSET} A Form Fieldset element\r\n\t*/\r\n\taddFieldset(model) {\r\n\t\tthis.children.push(new FIELDSET(this.body.pane, model));\r\n\t\treturn this.addGroup(this.children[this.children.length - 1]);\r\n\t}\r\n\t/** Populates this form with a single fieldset and formelementgroup\r\n\t    @param {EL} node Parent node\r\n\t    @param {boolean} hidden If true, form is hidden\r\n\t    @returns {FORM} An empty form container\r\n\t*/\r\n\tstatic createEmptyForm(node, hidden = false) {\r\n\t\tlet form = new FORM(node, new MODEL(new ATTRIBUTES({\r\n\t\t\t'style': hidden ? 'display:none;' : ''\r\n\t\t})).set({\r\n\t\t\t'label': 'FORM'\r\n\t\t}));\r\n\t\tform.addFieldset(new MODEL()).addFormElementGroup(new MODEL());\r\n\t\t/*let formElementGroup = fieldset.addFormElementGroup(\r\n\t\t    new MODEL().set({ 'label': 'FORMELEMENTGROUP' })\r\n\t\t);*/\r\n\t\t/*form.fieldset = new FIELDSET(form.body.pane, new MODEL().set({\r\n\t\t\t'label': 'FIELDSET'\r\n\t\t}));*/\r\n\t\t//form.fieldset.formElementGroup = new FORMELEMENTGROUP(form.fieldset.body.pane, new MODEL().set({\r\n\t\t//\t'label': 'FORMELEMENTGROUP'\r\n\t\t//}));\r\n\t\treturn form;\r\n\t}\r\n\t/**\r\n        Sets the POST url for this form\r\n        @param {string} url Target url\r\n        @returns {ThisType} Returns this form\r\n    */\r\n\tsetPostUrl(url) {\r\n\t\tthis.postUrl = url;\r\n\t\treturn this;\r\n\t}\r\n\t/** Disables all fieldsets within this form\r\n\t    @returns {boolean} Returns true if successful\r\n\t*/\r\n\tlock() {\r\n\t\ttry {\r\n\t\t\tfor (let i = 0; i < this.children.length; i++) {\r\n\t\t\t\tthis.children[i].el.disabled = true;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log('Unable to lock this form');\r\n\t\t\tthrow e;\r\n\t\t}\r\n\t}\r\n\t/** Enables all fieldsets within this form\r\n\t    @returns {boolean} Returns true if successful\r\n\t*/\r\n\tunlock() {\r\n\t\tfor (let i = 0; i < this.children.length; i++) {\r\n\t\t\ttry {\r\n\t\t\t\tthis.children[i].el.disabled = false;\r\n\t\t\t} catch (e) {\r\n\t\t\t\tif (e instanceof TypeError) {\r\n\t\t\t\t\tconsole.warn('Unable to lock \"' + this.children[i].element + '\"');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/** HTML encodes all form element values\r\n\t    @returns {void}\r\n\t*/\r\n\thtmlEncodeValues() {\r\n\t\ttry {\r\n\t\t\tfor (let e = 0; e < this.el.elements.length; e++) {\r\n\t\t\t\t//console.log('Encode type: ' + this.el.elements[e].type);\r\n\t\t\t\tif (this.el.elements[e].type.toUpperCase() === 'TEXT' || this.el.elements[e].type.toUpperCase() === 'TEXTAREA') {\r\n\t\t\t\t\tthis.el.elements[e].value = this.htmlEncode(this.el.elements[e].value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log('FORM.htmlEncodeValues() failed.');\r\n\t\t\tthrow e;\r\n\t\t}\r\n\t}\r\n\t/** Flags the given element as invalid \r\n\t\t@param {any} element The form element\r\n\t    @returns {void}\r\n\t*/\r\n\tsetInvalid(element) {\r\n\t\tthis.payload.isValid = false;\r\n\t\telement.focus();\r\n\t\telement.setAttribute('data-valid', this.payload.isValid);\r\n\t\t$(element.previousSibling).addClass('invalid'); // Set label class to 'invalid'\r\n\t}\r\n\t/** Validate the current form and return true if form is valid\r\n\t    Note that this is a simple form of validation that occurs on the\r\n\t    client side and should not be used as a substitution for\r\n\t    server side validation.\r\n\t    @returns {object} The validation payload\r\n\t*/\r\n\tvalidate() {\r\n\t\tthis.htmlEncodeValues();\r\n\t\tthis.payload = {\r\n\t\t\tisValid: true,\r\n\t\t\tformName: this.el.name\r\n\t\t};\r\n\t\tfor (let e = 0; e < this.el.elements.length; e++) {\r\n\t\t\tswitch (this.el.elements[e].type) {\r\n\t\t\t\tcase 'input':\r\n\t\t\t\tcase 'text':\r\n\t\t\t\tcase 'email':\r\n\t\t\t\tcase 'tel':\r\n\t\t\t\tcase 'password':\r\n\t\t\t\t\tif (this.el.elements[e].checkValidity()) { // HTML5 Validation\r\n\t\t\t\t\t\tif (this.el.elements[e].value === '') {\r\n\t\t\t\t\t\t\tthis.setInvalid(this.el.elements[e]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$(this.el.elements[e]).removeClass('invalid');\r\n\t\t\t\t\t\t\tthis.el.elements[e].setAttribute('data-valid', this.payload.isValid);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log(this.el.elements[e].name + ' -- isValid: ' + this.el.elements[e].checkValidity());\r\n\t\t\t\t\t\tthis.setInvalid(this.el.elements[e]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\tif (this.el.elements[e].required) {\r\n\t\t\t\t\t\tif (!this.el.elements[e].checked) {\r\n\t\t\t\t\t\t\tthis.setInvalid(this.el.elements[e]);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'select-one':\r\n\t\t\t\t\tif (this.el.elements[e].selectedIndex === 0) {\r\n\t\t\t\t\t\tthis.setInvalid(this.el.elements[e]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(this.el.elements[e]).removeClass('invalid');\r\n\t\t\t\t\t\tthis.el.elements[e].setAttribute('data-valid', this.payload.isValid);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unable to validate unidentified form element type.');\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.log('Validation Result: ' + this.payload.isValid);\r\n\t\treturn this.payload;\r\n\t}\r\n\t/** Resets the form and any validation notifications.\r\n        @returns {void}\r\n\t*/\r\n\treset() {\r\n\t\tconsole.log('Resetting form[' + this.el.name + ']');\r\n\t\tfor (let e = 0; e < this.el.elements.length; e++) {\r\n\t\t\tthis.el.elements[e].removeAttribute('data-valid');\r\n\t\t\t$(this.el.elements[e].previousSibling).removeClass('invalid');\r\n\t\t}\r\n\t\tthis.el.reset();\r\n\t}\r\n\t/**\r\n\t    Serialize the form into an array\r\n\t    @returns {array} Form Results as an Array of key/value pairs\r\n\t*/\r\n\tgetResultsAsArray() {\r\n\t\tconsole.log('FORM.getResultsAsArray()');\r\n\t\treturn $(this.el).serializeArray();\r\n\t}\r\n\t/**\r\n\t    If valid, Returns a FormPost based on values in this form\r\n\t    @returns {FormPost} A FormPost Object\r\n\t*/\r\n\tgetFormPost() {\r\n\t\treturn this.validate().isValid ? new FORMPOST(this) : null;\r\n\t}\r\n\t/** Creates an Input Model\r\n\t    @param {string} element Element name\r\n\t    @param {string} name Input name\r\n\t    @param {string} label Label to display\r\n\t    @param {string} value Value of input\r\n\t    @param {string} type The input type\r\n\t    @returns {MODEL} An input model\r\n\t */\r\n\tstatic createInputModel(element, name, label, value = '', type = 'TEXT') {\r\n\t\treturn new MODEL(new ATTRIBUTES({\r\n\t\t\tname,\r\n\t\t\tvalue,\r\n\t\t\t'type': type === 'FORMPOSTINPUT' ? 'NUMBER' : type\r\n\t\t})).set({\r\n\t\t\telement,\r\n\t\t\tlabel,\r\n\t\t\ttype\r\n\t\t})\r\n\t}\r\n\t/** Post values to server.\r\n\t\tPosts the contents of the given Form Post to the specified url\r\n\t\tand updates the given prompt.\r\n\t\tparam {CONTAINER} master The master element whos state and id is to be updated\r\n\t    @async\r\n\t    @returns {Promise<object>} The results of the Form Post\r\n\t*/\r\n\tpost() {\r\n\t\tconsole.log(10, 'Posting values to server: ' + this.postUrl);\r\n\t\tlet formPost = this.getFormPost();\r\n\t\tif (formPost) {\r\n\t\t\tthis.lock();\r\n\t\t\t//console.log('Posting to: ' + this.postUrl, formPost);\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: this.postUrl,\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\tdata: formPost,\r\n\t\t\t\terror(xhr, statusText, errorThrown) {\r\n\t\t\t\t\tconsole.log(100, 'Access Denied: ' + statusText + '(' + xhr.status + ')', errorThrown);\r\n\t\t\t\t},\r\n\t\t\t\tstatusCode: {\r\n\t\t\t\t\t200(response) {\r\n\t\t\t\t\t\tconsole.log('StatusCode: 200', response.message, true);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t201(response) {\r\n\t\t\t\t\t\tconsole.log('StatusCode: 201', response);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t400(response) {\r\n\t\t\t\t\t\tconsole.log('StatusCode: 400', response);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t403(response) {\r\n\t\t\t\t\t\tconsole.log('StatusCode: 403', 'Access Denied. Log in to continue', response);\r\n\t\t\t\t\t\t//app.login();\r\n\t\t\t\t\t},\r\n\t\t\t\t\t404(response) {\r\n\t\t\t\t\t\tconsole.log('StatusCode: 404', response);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: (payload) => {\r\n\t\t\t\t\tconsole.log('Posted results to server.', payload.message);\r\n\t\t\t\t\tthis.unlock();\r\n\t\t\t\t\tthis.afterSuccessfulPost(payload);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconsole.log(0, 'Post Failed to submit.  Values may be invalid.');\r\n\t\t\tthis.getMainContainer().loader.showConsole();\r\n\t\t}\r\n\t}\r\n}\r\nexport { ATTRIBUTES, FORMFOOTER, FORMINPUT, FORMPOST, INPUTTYPES, MODEL };"]}