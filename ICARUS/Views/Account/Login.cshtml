@using ICARUS.Models
@model LoginViewModel
@{
    ViewBag.Title = "Login";
}
@section viewInit {
    @Html.AntiForgeryToken()
    @if (!User.Identity.IsAuthenticated) {
        <script type="text/javascript">
            console.log('Login Page');
            var token = document.getElementsByName('__RequestVerificationToken')[0];  
            var factory = new CONTAINERFACTORY();
            var app = new MAIN(new MODEL().set({
                'label': 'Log In',
                'navBar': {
                    'label': 'Log In'
                }
            }));

            app.prompt = new PROMPT('Log In', 'You must log in to continue');

            app.prompt.form.setPostUrl('/Account/Login');
            app.prompt.form.el.setAttribute('method', 'POST');
            app.prompt.form.el.setAttribute('action', '#');

            this.email = new INPUT(app.prompt.formElementGroup.body.pane,
                new MODEL(
                    new ATTRIBUTES({
                        'typeId': IcarusInputType.INPUT,
                        'type': 'Email',
                        'name': 'Email'
                    })
                ).set({
                    'label': 'Username',
                    'showHeader': 0
                })
            );

            console.log('LOGIN: PASSWORD');
            this.password = new INPUT(app.prompt.formElementGroup.body.pane,
                new MODEL(
                    new ATTRIBUTES({
                        'typeId': IcarusInputType.PASSWORD,
                        'type': 'Password',
                        'name': 'Password'
                    })
                ).set({
                    'label': 'Password',
                    'showHeader': 0
                })
            );
            
            app.prompt.form.footer.buttonGroup.children[0].el.style.display = 'none';
            app.prompt.form.footer.buttonGroup.children[1].el.onclick = function () {
                app.prompt.form.el.submit();
            }

            app.prompt.show();

            /*
                TODO:
                Create INPUT CHECKBOX called 'RememberMe'
                Create BUTTON to launch 'Register as new User'
                Create AHREF to 'ForgotPassword'
            */

        </script>
    } else {
        <script type="text/javascript">
            var token = document.getElementsByName('__RequestVerificationToken')[0];
            var app = new MAIN(new MODEL().set('label', 'Log In'), token.value);
            app.prompt = new PROMPT('Log In', 'You are already logged in.\nRedirecting...');
            app.prompt.show();
            setTimeout(function () {
                location.href = '/'; //https://www.w3schools.com/jsref/met_loc_reload.asp
            }, 1000);
        </script>
    }
}
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}